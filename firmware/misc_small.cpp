//=========================================================================================================
// misc_small.h - This file contains implementations for various small classes
//=========================================================================================================
#include "globals.h"

//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
//                                   USB CONNECTION SENSOR
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><


//=========================================================================================================
// current_state() - Returns true if the USB is connected, otherwise returns false
//=========================================================================================================
bool CUSBSensor::current_state()
{
    return analogRead(A0) > 400;    
}
//=========================================================================================================


//=========================================================================================================
// execute() - State machine used to sense and report changes of state in the USB connection
//=========================================================================================================
void CUSBSensor::execute()
{
    // Find out of the USB is currently plugged in
    unsigned char is_connected = current_state() ? 1 : 0;

    // If this state is different than the last sensed state...
    if (is_connected != m_state)
    {
        m_state = is_connected;
        on_change_of_state();        
    }
}
//=========================================================================================================


//=========================================================================================================
// on_change_of_state() - Called anytime the state of the USB connection changes
//=========================================================================================================
void CUSBSensor::on_change_of_state()
{
    if (m_state)
        Led.set(GREEN);
    else
        Led.set(RED);
}
//=========================================================================================================



//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
// 
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
//<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><
